### í”„ë¡œì íŠ¸ ê°œìš”

**â€˜ì˜¬ë¦¬ë¸Œì˜ O2O ì„œë¹„ìŠ¤, ê³ ê° ê²½í—˜ì„ í˜ì‹ í•˜ëŠ” ì¸í”„ë¼ ì„¤ê³„â€™ í”„ë¡œì íŠ¸**ëŠ” ì˜¨Â·ì˜¤í”„ë¼ì¸ ì‚¬ìš©ì ê²½í—˜ì˜ ê²©ì°¨ë¥¼ ì¤„ì´ê³ , ë”ìš± **ì‹¤ì‹œê°„ì„±**, **í™•ì¥ì„±**, **ê³ ê°€ìš©ì„±**ì„ ê°–ì¶˜ ì¸í”„ë¼ë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í–ˆìŠµë‹ˆë‹¤. 

### í”„ë¡œì íŠ¸ ì¶”ì§„ ë°°ê²½

O2O(Online to Offline) ì„œë¹„ìŠ¤ëŠ” ì˜¨ë¼ì¸ í”Œë«í¼ì„ í†µí•´ ì˜¤í”„ë¼ì¸ ì„œë¹„ìŠ¤ë¥¼ ì˜ˆì•½í•˜ê±°ë‚˜ ì£¼ë¬¸í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ë¡œ, ìµœê·¼ ìœ í†µ ì—…ê³„ì—ì„œ í•„ìˆ˜ì ì¸ ì„œë¹„ìŠ¤ë¡œ ìë¦¬ ì¡ì•˜ìŠµë‹ˆë‹¤. íŠ¹íˆ ì˜¬ë¦¬ë¸Œì˜ì€ êµ­ë‚´ ëŒ€í‘œì ì¸ H&B(Health & Beauty) ë¸Œëœë“œë¡œ, ì˜¤í”„ë¼ì¸ ë§¤ì¥ì„ ê¸°ë°˜ìœ¼ë¡œ ì•±ì„ í†µí•œ ì£¼ë¬¸ ë° í”½ì—… ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì‹¤ì œ í˜„ì¥ì„ ë°©ë¬¸í•œ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œì ë“¤ì´ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤

- **ì¬ê³  ì°¨ê° ì‹œì ì˜ ë¶ˆì¼ì¹˜**ë¡œ ì¸í•´ ì•± ì£¼ë¬¸ ê³ ê°ê³¼ í˜„ì¥ ê³ ê° ê°„ ì¬ê³  ì¶©ëŒì´ ë°œìƒí•¨
- ì‹¤ì‹œê°„ ì¬ê³  ë°˜ì˜ì´ ë˜ì§€ ì•Šì•„ **ì£¼ë¬¸ í›„ í’ˆì ˆ í†µë³´**ë¥¼ ë°›ëŠ” ê²½ìš°ê°€ ë¹ˆë²ˆí•¨
- ë§¤ì¥ ì§ì›ì€ ì£¼ë¬¸ ì²˜ë¦¬ë¡œ ì¸í•´ ì—…ë¬´ê°€ ê³¼ì¤‘ë˜ê³ , ê³ ê° ì‘ëŒ€ì˜ ì§ˆì´ ì €í•˜ë¨
- ê³ ê° ì…ì¥ì—ì„œë„ ë§¤ì¥ ì¬ê³  í™•ì¸ê³¼ ìƒí’ˆ í™•ë³´ì— ëŒ€í•œ **ë¶ˆì‹ **ì´ ì¡´ì¬í•¨

**ìœ„ì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ê³ ê°€ìš©ì„± ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ AWS í´ë¼ìš°ë“œ í”Œë«í¼ê³¼ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì•„í‚¤í…ì²˜(EKS)**ë¥¼ ì„ íƒí•˜ê³ , ì¸í”„ë¼ ìë™í™”, ë³´ì•ˆ, ëª¨ë‹ˆí„°ë§ ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ê³ ë ¤í•˜ì˜€ìŠµë‹ˆë‹¤.

## ì›¹ ì‹œì—°

![ì›¹ì‹œì—°](ì›¹_ì‹œì—°.gif)

## ì•„í‚¤í…ì²˜

![ì•„í‚¤í…ì²˜](https://github.com/vermeil2/2025-cloudwave-terraform/blob/main/%EC%9D%B8%ED%94%84%EB%9D%BC%20%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png)

## **ì•„í‚¤í…ì²˜ ì„¤ê³„**

### ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

ë³¸ í”„ë¡œì íŠ¸ëŠ” **ì‹¤ì‹œê°„ì„±, í™•ì¥ì„±, ê³ ê°€ìš©ì„±**ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ **EKS ê¸°ë°˜ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜**ë¥¼ ë„ì…í–ˆìŠµë‹ˆë‹¤. ìš´ì˜ í™˜ê²½ì€ **Seoul ë¦¬ì „ì„ ê¸°ì¤€ìœ¼ë¡œ êµ¬ì„±**ë˜ë©°, **Tokyo ë¦¬ì „ì€ ì¬í•´ ë³µêµ¬(DR, Disaster Recovery)** ìš©ë„ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

- **í´ë¼ì´ì–¸íŠ¸ ì ‘ê·¼ ê²½ë¡œ**: Route53, WAF, CloudFront, ACMì„ í†µí•´ ì•ˆì „í•˜ê²Œ ë¼ìš°íŒ…
- **ì„œë¹„ìŠ¤ ìš´ì˜ í™˜ê²½**: ì„œìš¸ ë¦¬ì „ì˜ Amazon EKSì—ì„œ ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ìš´ì˜
- **ì¬í•´ë³µêµ¬ í™˜ê²½**: ë„ì¿„ ë¦¬ì „ì— ì´ì¤‘í™”ëœ EKS, DB í™˜ê²½ êµ¬ì„±
- **ì‹¤ì‹œê°„ ì²˜ë¦¬ ê¸°ë°˜**: Redis + Kafka ì¡°í•©ìœ¼ë¡œ ë¹ ë¥´ê³  í™•ì¥ ê°€ëŠ¥í•œ ë°ì´í„° ì²˜ë¦¬
- **ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…**: Grafana, Prometheus, CloudWatch, Athena ë“± ë„ì…
- **ë°°í¬ ìë™í™”**: GitLab â†’ Jenkins â†’ ECR â†’ ArgoCD ê¸°ë°˜ì˜ GitOps íŒŒì´í”„ë¼ì¸ ìš´ì˜

## ì£¼ìš” ê¸°ëŠ¥

### ë„¤íŠ¸ì›Œí¬ ì¸í”„ë¼
- **VPC**: ë©€í‹° AZ ê³ ê°€ìš©ì„± ë„¤íŠ¸ì›Œí¬ êµ¬ì„±
- **ì„œë¸Œë„·**: Public/Private ì„œë¸Œë„· ë¶„ë¦¬ (ê° AZë³„)
- **NAT Gateway**: Private ì„œë¸Œë„·ì˜ ì•„ì›ƒë°”ìš´ë“œ íŠ¸ë˜í”½ ì²˜ë¦¬
- **Internet Gateway**: Public ì„œë¸Œë„· ì¸í„°ë„· ì—°ê²°

### EKS í´ëŸ¬ìŠ¤í„°
- **Kubernetes Control Plane**: ê´€ë¦¬í˜• EKS í´ëŸ¬ìŠ¤í„°
- **Node Groups**: ìë™ ìŠ¤ì¼€ì¼ë§ ê°€ëŠ¥í•œ ì›Œì»¤ ë…¸ë“œ
- **IAM Roles**: í´ëŸ¬ìŠ¤í„° ë° ë…¸ë“œìš© IAM ì—­í•  êµ¬ì„±
- **OIDC Provider**: IRSA(IAM Roles for Service Accounts) ì§€ì›

### Kubernetes Add-ons
- **Metrics Server**: ë¦¬ì†ŒìŠ¤ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- **Cluster Autoscaler**: ë…¸ë“œ ìë™ ìŠ¤ì¼€ì¼ë§
- **AWS Load Balancer Controller**: ALB/NLB ìë™ í”„ë¡œë¹„ì €ë‹
- **Prometheus + Grafana**: ëª¨ë‹ˆí„°ë§ ë° ëŒ€ì‹œë³´ë“œ
- **ArgoCD**: GitOps ê¸°ë°˜ ë°°í¬ ìë™í™”

### ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´
- **IRSA**: ECR ì ‘ê·¼ì„ ìœ„í•œ IAM Roles for Service Accounts
- **IAM Policies**: ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
- **Network Isolation**: Private/Public ì„œë¸Œë„· ë¶„ë¦¬

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
terraform-env/
â”œâ”€â”€ main.tf                    # ë©”ì¸ ëª¨ë“ˆ êµ¬ì„±
â”œâ”€â”€ variables.tf                # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ output.tf                  # ì¶œë ¥ ê°’ ì •ì˜
â”œâ”€â”€ provider.tf                # Provider ì„¤ì •
â”œâ”€â”€ tfbackend.tf               # Terraform Backend ì„¤ì •
â”œâ”€â”€ README.md                  # í”„ë¡œì íŠ¸ ë¬¸ì„œ
â”‚
â”œâ”€â”€ environments/              # í™˜ê²½ë³„ ì„¤ì •
â”‚   â”œâ”€â”€ prod/
â”‚   â”‚   â””â”€â”€ terraform.tfvars   # Production í™˜ê²½ ë³€ìˆ˜
â”‚   â”œâ”€â”€ staging/
â”‚   â”‚   â””â”€â”€ terraform.tfvars   # Staging í™˜ê²½ ë³€ìˆ˜
â”‚   â””â”€â”€ DR/
â”‚       â””â”€â”€ terraform.tfvars   # Disaster Recovery í™˜ê²½ ë³€ìˆ˜
â”‚
â””â”€â”€ modules/                   # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ëª¨ë“ˆ
    â”œâ”€â”€ network/               # VPC, Subnet, NAT Gateway
    â”œâ”€â”€ eks/                   # EKS í´ëŸ¬ìŠ¤í„° ë° Node Groups
    â”œâ”€â”€ metric-server/         # Kubernetes Metrics Server
    â”œâ”€â”€ cluster-autoscaler/    # Cluster Autoscaler
    â”œâ”€â”€ lb-controller/         # AWS Load Balancer Controller
    â”œâ”€â”€ monitoring/            # Prometheus + Grafana
    â”œâ”€â”€ argocd/                # ArgoCD GitOps
    â””â”€â”€ ecr-irsa/              # ECR ì ‘ê·¼ì„ ìœ„í•œ IRSA
```

## ê¸°ìˆ  ìŠ¤íƒ

- **Infrastructure as Code**: Terraform
- **Cloud Provider**: AWS
- **Container Orchestration**: Amazon EKS (Kubernetes)
- **Package Management**: Helm
- **Monitoring**: Prometheus, Grafana
- **CI/CD**: ArgoCD (GitOps)
- **Backend**: Terraform S3 Backend

## ì‚¬ì „ ì¤€ë¹„

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

- AWS CLI ì„¤ì¹˜ ë° êµ¬ì„±
- Terraform >= 1.0
- kubectl ì„¤ì¹˜
- Helm 3.x ì„¤ì¹˜
- ì ì ˆí•œ AWS ê¶Œí•œ (IAM, EC2, EKS, VPC ë“±)

### ì‚¬ìš© ë°©ë²•

1. **Terraform ì´ˆê¸°í™”**
   ```bash
   terraform init
   ```

2. **í™˜ê²½ ì„ íƒ ë° ë³€ìˆ˜ íŒŒì¼ ì„¤ì •**
   ```bash
   # Staging í™˜ê²½
   terraform workspace select staging
   terraform plan -var-file=./environments/staging/terraform.tfvars
   terraform apply -var-file=./environments/staging/terraform.tfvars
   
   # Production í™˜ê²½
   terraform workspace select prod
   terraform plan -var-file=./environments/prod/terraform.tfvars
   terraform apply -var-file=./environments/prod/terraform.tfvars
   ```

3. **Kubernetes í´ëŸ¬ìŠ¤í„° ì—°ê²°**
   ```bash
   aws eks --region <region> update-kubeconfig --name <cluster-name>
   ```

4. **ë°°í¬ í™•ì¸**
   ```bash
   kubectl get nodes
   kubectl get pods --all-namespaces
   ```

## âš™ï¸ ì£¼ìš” ë³€ìˆ˜

| ë³€ìˆ˜ëª… | ì„¤ëª… | ë‚´ìš© |
|--------|------|------|
| `env` | í™˜ê²½ ì´ë¦„ | `prod`, `staging` |
| `region` | AWS ë¦¬ì „ | `ap-northeast-2` |
| `eks_name` | EKS í´ëŸ¬ìŠ¤í„° ì´ë¦„ | `my-eks-cluster` |
| `eks_version` | Kubernetes ë²„ì „ | `1.31` |
| `instance_types` | ë…¸ë“œ ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… | `t3.large` |
| `zone1`, `zone2` | ê°€ìš© ì˜ì—­ | `ap-northeast-2a`, `ap-northeast-2c` |
| `private_zone1_cidr` | Private ì„œë¸Œë„· CIDR (Zone 1) | `10.1.16.0/20` |
| `public_zone1_cidr` | Public ì„œë¸Œë„· CIDR (Zone 1) | `10.1.144.0/20` |

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- ëª¨ë“  ë¯¼ê°í•œ ì •ë³´ëŠ” ë³€ìˆ˜ë¡œ ê´€ë¦¬í•˜ë©° `.tfvars` íŒŒì¼ì€ ë²„ì „ ê´€ë¦¬ì—ì„œ ì œì™¸
- IAM ì •ì±…ì€ ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
- Private ì„œë¸Œë„·ì— ì›Œì»¤ ë…¸ë“œ ë°°ì¹˜
- OIDC ê¸°ë°˜ IRSAë¥¼ í†µí•œ ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ ê´€ë¦¬

## ğŸ“ ì£¼ì˜ì‚¬í•­

- **Terraform Destroy ì‹œ**: ë¡œë“œë°¸ëŸ°ì„œê°€ ìƒì„±ëœ ê²½ìš°, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤(ENI)ê°€ ìë™ìœ¼ë¡œ ì‚­ì œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ EC2 ì½˜ì†”ì—ì„œ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ë¨¼ì € ì‚­ì œí•œ í›„ destroyë¥¼ ì‹¤í–‰í•˜ì„¸ìš”. ë˜í•œ, S3 ì‚­ì œì‹œ ë²„í‚· ë‚´ìš©ì„ ë¹„ìš°ì§€ ì•Šìœ¼ë©´ ì‚­ì œë˜ì§€ ì•Šìœ¼ë‹ˆ ì£¼ì˜í•˜ì„¸ìš”.
